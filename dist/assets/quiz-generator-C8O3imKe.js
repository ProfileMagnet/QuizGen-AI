var X=Object.defineProperty,Z=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var te=Object.prototype.hasOwnProperty,re=Object.prototype.propertyIsEnumerable;var L=(a,l,s)=>l in a?X(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s,E=(a,l)=>{for(var s in l||(l={}))te.call(l,s)&&L(a,s,l[s]);if(Q)for(var s of Q(l))re.call(l,s)&&L(a,s,l[s]);return a},O=(a,l)=>Z(a,ee(l));var K=(a,l,s)=>new Promise((A,z)=>{var k=r=>{try{w(s.next(r))}catch(g){z(g)}},u=r=>{try{w(s.throw(r))}catch(g){z(g)}},w=r=>r.done?A(r.value):Promise.resolve(r.value).then(k,u);w((s=s.apply(a,l)).next())});import{r as d,j as e,h as se,i as ne,S as ie}from"./react-vendor-B9ZGZSHM.js";import{C as oe,L as ae,a as le,M as ce,b as ue,F as de,O as ge}from"./components-Cnf930Vq.js";import"./vendor-DXIr2iB9.js";import"./quiz-generator-C8O3imKe.js";const xe=()=>{const[a,l]=d.useState(""),[s,A]=d.useState(""),[z,k]=d.useState("Medium"),[u,w]=d.useState("Multiple Choice"),[r,g]=d.useState([]),[y,j]=d.useState(!1),[D,p]=d.useState(!1),[U,v]=d.useState(!1),[m,I]=d.useState(""),[B,_]=d.useState(""),[R,x]=d.useState(0),C=d.useRef(null),S=d.useMemo(()=>r.map(n=>n.question),[r]);d.useEffect(()=>{const n=localStorage.getItem("quizgen-api-key");n&&A(n)},[]);const q=d.useCallback((n=!1)=>K(null,null,function*(){if(!a.trim()||!s.trim()){alert("Please provide both topic and Hugging Face API key");return}localStorage.setItem("quizgen-api-key",s),j(!0),C.current&&C.current.abort(),C.current=new AbortController;try{const h={"Multiple Choice":"create_mcqs","Fill in the Blanks":"create_fill_blanks","True or False":"create_true_or_false_quiz",Ordering:"create_ordering_quiz",Matching:"create_matching_quiz"},T="https://quiz-generator-from-text.onrender.com",M=h[u],Y={text:`Generate a quiz about: ${a}`,level:z.toLowerCase(),past_quiz_qns:S,api_key:s},N=E({},Y);console.log("Making API request with:",O(E({endpoint:`${T}/${M}/`},N),{api_key:s.substring(0,10)+"...",quizType:u}));const V=new Promise((o,t)=>{setTimeout(()=>{t(new Error("Request timeout after 60 seconds"))},6e4)}),W=fetch(`${T}/${M}/`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},signal:C.current.signal,body:JSON.stringify(N)}),f=yield Promise.race([W,V]);if(console.log("Response status:",f.status),console.log("Response headers:",f.headers),!f.ok){const o=yield f.text();throw console.error("Error response:",o),f.status===401||f.status===403||o.includes("Unauthorized")?new Error("Invalid API key. Please check your Hugging Face API key and try again."):f.status===429?new Error("Rate limit exceeded. Please wait a moment and try again."):new Error(o||`Request failed with status ${f.status}`)}const i=yield f.json();if(console.log("API Response:",i),u==="Multiple Choice"){const o=Array.isArray(i.quiz_out)?i.quiz_out:Array.isArray(i.quiz)?i.quiz:null;if(!o)throw console.error("Unexpected MCQ response format:",i),new Error("Invalid response format from API (Multiple Choice)");const t=o.map((c,F)=>({id:n?r.length+F+1:F+1,question:c.question,options:c.options,correctAnswer:c.answer_index,type:"mcq"}));console.log("Normalized MCQ questions:",t),n?(g(c=>[...c,...t]),p(!0)):(g(t),p(!0))}else if(u==="True or False"){if(!i.quiz_out||!Array.isArray(i.quiz_out))throw console.error("Unexpected response format for True/False:",i),new Error("Invalid response format from API (True/False)");const o=i.quiz_out.map((t,c)=>({id:n?r.length+c+1:c+1,question:t.question,options:["True","False"],correctAnswer:t.answer?0:1,type:"tf"}));n?(g(t=>[...t,...o]),p(!0)):(g(o),p(!0))}else if(u==="Fill in the Blanks"){if(!i.quiz_out||!Array.isArray(i.quiz_out))throw console.error("Unexpected response format for Fill in the Blanks:",i),new Error("Invalid response format from API (Fill in the Blanks)");const o=i.quiz_out.map((t,c)=>({id:n?r.length+c+1:c+1,question:t.question,options:[],correctAnswer:0,type:"fib",answersList:Array.isArray(t.answers_list)?t.answers_list.map(F=>F.toLowerCase()):[]}));n?(g(t=>[...t,...o]),p(!0)):(g(o),p(!0))}else if(u==="Ordering"){if(!i.quiz_out||!Array.isArray(i.quiz_out))throw console.error("Unexpected response format for Ordering:",i),new Error("Invalid response format from API (Ordering)");const o=i.quiz_out.map((t,c)=>({id:n?r.length+c+1:c+1,question:t.question||"Arrange the following in correct order",options:[],correctAnswer:0,type:"ordering",orderingContents:t.contents,orderingAnswerIndexList:t.answer_index_list}));n?(g(t=>[...t,...o]),p(!0)):(g(o),p(!0))}else if(u==="Matching"){if(!i.quiz_out||!Array.isArray(i.quiz_out))throw console.error("Unexpected response format for Matching:",i),new Error("Invalid response format from API (Matching)");const o=i.quiz_out.map((t,c)=>({id:n?r.length+c+1:c+1,question:"Match the following",options:[],correctAnswer:0,type:"matching",matchingLeft:t.left_contents,matchingRight:t.right_contents,matchingAnswerIndexList:t.answer_index_list}));n?(g(t=>[...t,...o]),p(!0)):(g(o),p(!0))}x(0)}catch(h){if(console.error("Full error:",h),h instanceof Error&&h.name==="AbortError"){console.log("Request was aborted");return}if(h instanceof Error&&h.message==="Request timeout after 60 seconds"){if(R===0){console.log("First timeout, auto retrying..."),x(1);return}else I("Server Unresponsive"),_("The server appears to be down or taking too long to respond. Please try again later."),v(!0),x(0);j(!1);return}if(h instanceof Error&&(h.message.includes("Invalid API key")||h.message.includes("Unauthorized"))){I("Invalid API Key"),_("The provided Hugging Face API key is invalid or unauthorized. Please check your key and try again."),v(!0),x(0),j(!1);return}if(h instanceof Error&&h.message.includes("Rate limit exceeded")){I("Rate Limit Exceeded"),_("You have exceeded the rate limit. Please wait a moment and try again."),v(!0),x(0),j(!1);return}I("Error Generating Quiz"),_(h instanceof Error?h.message:"An unexpected error occurred. Please try again."),v(!0),x(0)}finally{j(!1)}}),[a,s,r,R,S,z,u]),H=d.useCallback(()=>{console.log("Auto retry triggered"),q(!1)},[q]),G=()=>{v(!1),m!=="Invalid API Key"&&m!=="Rate Limit Exceeded"&&q(!1)},$=()=>{v(!1),x(0)},P=()=>{l(""),k("Medium"),g([]),p(!1)},J=()=>{localStorage.removeItem("quizgen-api-key"),A("")},b=()=>{q(!0)};return e.jsxs("div",{className:"quiz-generator-page",children:[e.jsx(oe,{isOpen:U,title:m,message:B,onRetry:G,onCancel:$,retryText:m==="Invalid API Key"?"OK":"Retry",showRetry:m!=="Invalid API Key"&&m!=="Server Unresponsive",showCancel:!0,type:m==="Invalid API Key"||m==="Rate Limit Exceeded"?"error":m==="Request Taking Longer Than Expected"||m==="Server Unresponsive"?"warning":"info"}),y&&e.jsx(ae,{message:"Generating your quiz...",onTimeout:H}),D&&e.jsx(le,{onComplete:()=>p(!1),duration:4e3}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"quiz-header",children:[e.jsxs("button",{className:"back-button",onClick:()=>window.history.back(),children:[e.jsx(se,{size:20}),"Home"]}),e.jsx("div",{className:"quiz-header-content",children:e.jsxs("h1",{className:"page-title",children:[e.jsx("img",{src:"/icon.png",alt:"QuizGen AI",className:"title-icon"}),"QuizGen AI"]})})]}),r.length===0?e.jsx("div",{className:"generator-form",children:e.jsxs("div",{className:"form-card",children:[e.jsx("h2",{children:"Create Your Quiz"}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"topic",children:"Topic"}),e.jsx("input",{type:"text",id:"topic",placeholder:"Enter a topic (e.g., JavaScript, History, Biology)",value:a,onChange:n=>l(n.target.value)})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"difficulty",children:"Difficulty Level"}),e.jsxs("select",{id:"difficulty",value:z,onChange:n=>k(n.target.value),className:"difficulty-select",children:[e.jsx("option",{value:"Easy",children:"Easy"}),e.jsx("option",{value:"Medium",children:"Medium"}),e.jsx("option",{value:"Hard",children:"Hard"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"quizType",children:"Quiz Type"}),e.jsxs("select",{id:"quizType",value:u,onChange:n=>w(n.target.value),className:"difficulty-select",children:[e.jsx("option",{value:"Multiple Choice",children:"Multiple Choice"}),e.jsx("option",{value:"Fill in the Blanks",children:"Fill in the Blanks"}),e.jsx("option",{value:"True or False",children:"True or False"}),e.jsx("option",{value:"Ordering",children:"Ordering"}),e.jsx("option",{value:"Matching",children:"Matching"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{htmlFor:"apiKey",children:"Hugging Face API Key"}),e.jsxs("div",{className:"api-key-container",children:[e.jsx("input",{type:"password",id:"apiKey",placeholder:"Enter your Hugging Face API key",value:s,onChange:n=>A(n.target.value)}),s&&e.jsx("button",{type:"button",className:"clear-api-key-button",onClick:J,title:"Clear saved API key",children:"Clear"})]}),e.jsxs("div",{className:"form-help-container",children:[e.jsxs("small",{className:"form-help",children:["Get your API key from ",e.jsx("a",{href:"https://huggingface.co/settings/tokens",target:"_blank",rel:"noopener noreferrer",children:"Hugging Face Settings"})]}),e.jsxs("a",{href:"/documentation",className:"documentation-link",children:[e.jsx(ne,{size:16}),"Need help? View our interactive guide"]})]})]}),e.jsx("button",{className:"generate-button",onClick:()=>q(!1),disabled:y||!a.trim()||!s.trim(),children:y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner"}),"Generating Quiz"]}):e.jsxs(e.Fragment,{children:[e.jsx(ie,{size:20}),"Generate Quiz"]})})]})}):e.jsxs(e.Fragment,{children:[r.length>0&&u==="Matching"&&e.jsx(ce,{generatedQuiz:r,onReset:P,onGenerateMore:b,isGenerating:y}),r.length>0&&(u==="Multiple Choice"||u==="True or False")&&e.jsx(ue,{generatedQuiz:r,onReset:P,onGenerateMore:b,isGenerating:y}),r.length>0&&u==="Fill in the Blanks"&&e.jsx(de,{generatedQuiz:r,onReset:P,onGenerateMore:b,isGenerating:y}),r.length>0&&u==="Ordering"&&e.jsx(ge,{generatedQuiz:r,onReset:P,onGenerateMore:b,isGenerating:y})]})]})]})};export{xe as default};
